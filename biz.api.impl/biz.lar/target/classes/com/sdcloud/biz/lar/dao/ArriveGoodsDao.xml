<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sdcloud.biz.lar.dao.ArriveGoodsDao">
	
	<sql id="Region_Sql">
		regionId,regionCode,regionName,parentId,regionLevel,regionOrder,regionNameEn,regionShortNameEn 
	</sql>
	<sql id="Base_Column_List">
		o.id AS "o_id",`orderId`,`businessTypeId`,`businessTypeName`,`areaSettingId`,`placeOrder`,`orderStatusId`,`orderStatusName`,`larClientUserAddressId`,
		`distributeIllustrate`,`cancelOrderPersonId`,`cancelOrderPersonName`,`cancelOrderIllustrate`,`cancelDate`,`completionType`,`completionName`,
		`cancelTakePersonId`,`cancelTakePersonName`,`cancelTakeIllustrate`,`cancelTakeDate`,`cancelSendPersonId`,`cancelSendPersonName`,
		`cancelSendIllustrate`,`cancelSendDate`,`money`,`integral`,`salesmanId`,o.`createDate`,o.`enable`,`completionIllustrate`,`userId`,`userName`,
		`paymentIllustrate`,`confirmPersionId`,`confirmPersionName`,`finishDate`,`evaluateId`,`takeDate`,`sendSingleId`,`sendSingleName`,
		`distributeDate`,`maaDate`,`orderSourceId`,`orderSourceName`,`illustrate`,`paymentTypeId`,`paymentTypeName`,a.id AS "areaSetting.id",
		`mechanism` AS "areaSetting.mechanism", `taskTime` AS "areaSetting.taskTime",`areaName` AS "areaSetting.areaName",
		`acreage` AS "areaSetting.acreage", `areaPosition` AS "areaSetting.areaPosition",`startDate` AS "areaSetting.startDate",
		`endDate` AS "areaSetting.endDate",`remarks` AS "areaSetting.remarks",a.`createDate` AS "areaSetting.createDate",
		a.`enable` AS "areaSetting.enable",`mechanismId` AS "areaSetting.mechanismId",lengthService,failureTypeId,failureTypeName,appUserId   
	</sql>
	<sql id="Child_Column_List">
		c.`id`,c.`number`,c.`orderManagerId` AS "orderManager.id",c.`enable`,c.`createDate`,r.`id` AS "recyclingMaterial.id",
		r.`goodsId` AS "recyclingMaterial.goodsId",r.`goodsName` AS "recyclingMaterial.goodsName",confirmOrder,
		r.`goodsDescribe` AS "recyclingMaterial.goodsDescribe",r.`meteringCompany` AS "recyclingMaterial.meteringCompany",
		r.`imgUrl` AS "recyclingMaterial.imgUrl",r.`startUsing` AS "recyclingMaterial.startUsing",
		r.`startUsingForApp` AS "recyclingMaterial.startUsingForApp",r.`enable` AS "recyclingMaterial.enable",
		t.`id` AS "recyclingMaterial.recyclingTypeId.id",t.`typeName` AS "recyclingMaterial.recyclingTypeId.typeName",
		t.`enable` AS "recyclingMaterial.recyclingTypeId.enable" 
	</sql>
	<insert id="insertSelective" parameterType="com.sdcloud.api.lar.entity.OrderManager">
		insert into lar_ordermanager
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="orderId != null">
				orderId,
			</if>
			<if test="businessTypeId != null">
				businessTypeId,
			</if>
			<if test="businessTypeName != null">
				businessTypeName,
			</if>
			<if test="areaSetting != null and areaSetting.id!=null">
				areaSettingId,
			</if>
			<if test="placeOrder != null">
				placeOrder,
			</if>
			<if test="orderStatusId != null">
				orderStatusId,
			</if>
			<if test="orderStatusName != null">
				orderStatusName,
			</if>
			<if test="larClientUserAddress != null and larClientUserAddress.id!=null">
				larClientUserAddressId,
			</if>
			<if test="maaDate != null">
				maaDate,
			</if>
			<if test="orderSourceId != null">
				orderSourceId,
			</if>
			<if test="orderSourceName != null">
				orderSourceName,
			</if>
			<if test="illustrate != null">
				illustrate,
			</if>
			<if test="paymentTypeId != null">
				paymentTypeId,
			</if>
			<if test="paymentTypeName != null">
				paymentTypeName,
			</if>
			<if test="money != null">
				money,
			</if>
			<if test="integral != null">
				integral,
			</if>
			<if test="paymentIllustrate != null">
				paymentIllustrate,
			</if>
			<if test="confirmPersionId != null">
				confirmPersionId,
			</if>
			<if test="confirmPersionName != null">
				confirmPersionName,
			</if>
			<if test="finishDate != null">
				finishDate,
			</if>
			<if test="completionType != null">
				completionType,
			</if>
			<if test="completionName != null">
				completionName,
			</if>
			<if test="completionIllustrate != null">
				completionIllustrate,
			</if>
			<if test="userId != null">
				userId,
			</if>
			<if test="userName != null">
				userName,
			</if>
			<if test="takeDate != null">
				takeDate,
			</if>
			<if test="sendSingleId != null">
				sendSingleId,
			</if>
			<if test="sendSingleName != null">
				sendSingleName,
			</if>
			<if test="distributeDate != null">
				distributeDate,
			</if>
			<if test="distributeIllustrate != null">
				distributeIllustrate,
			</if>
			<if test="cancelOrderPersonId != null">
				cancelOrderPersonId,
			</if>
			<if test="cancelOrderPersonName != null">
				cancelOrderPersonName,
			</if>
			<if test="cancelOrderIllustrate != null">
				cancelOrderIllustrate,
			</if>
			<if test="cancelDate != null">
				cancelDate,
			</if>
			<if test="cancelTakePersonId != null">
				cancelTakePersonId,
			</if>
			<if test="cancelTakePersonName != null">
				cancelTakePersonName,
			</if>
			<if test="cancelTakeIllustrate != null">
				cancelTakeIllustrate,
			</if>
			<if test="cancelTakeDate != null">
				cancelTakeDate,
			</if>
			<if test="cancelSendPersonName != null">
				cancelSendPersonName,
			</if>
			<if test="cancelSendPersonId != null">
				cancelSendPersonId,
			</if>
			<if test="cancelSendIllustrate != null">
				cancelSendIllustrate,
			</if>
			<if test="cancelSendDate != null">
				cancelSendDate,
			</if>
			<if test="salesman != null and salesman.id!=null">
				salesmanId,
			</if>
			<if test="createDate != null">
				createDate,
			</if>
			<if test="enable != null">
				enable,
			</if>
			<if test="evaluateId != null">
				evaluateId,
			</if>
			<if test="lengthService != null">
				lengthService,
			</if>
			<if test="failureTypeId != null">
				failureTypeId,
			</if>
			<if test="failureTypeName != null">
				failureTypeName,
			</if>
			<if test="appUserId != null">
				appUserId,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id},
			</if>
			<if test="orderId != null">
				#{orderId},
			</if>
			<if test="businessTypeId != null">
				#{businessTypeId},
			</if>
			<if test="businessTypeName != null">
				#{businessTypeName},
			</if>
			<if test="areaSetting != null and areaSetting.id!=null">
				#{areaSetting.id},
			</if>
			<if test="placeOrder != null">
				#{placeOrder},
			</if>
			<if test="orderStatusId != null">
				#{orderStatusId},
			</if>
			<if test="orderStatusName != null">
				#{orderStatusName},
			</if>
			<if test="larClientUserAddress != null and larClientUserAddress.id!=null">
				#{larClientUserAddress.id},
			</if>
			<if test="maaDate != null">
				#{maaDate},
			</if>
			<if test="orderSourceId != null">
				#{orderSourceId},
			</if>
			<if test="orderSourceName != null">
				#{orderSourceName},
			</if>
			<if test="illustrate != null">
				#{illustrate},
			</if>
			<if test="paymentTypeId != null">
				#{paymentTypeId},
			</if>
			<if test="paymentTypeName != null">
				#{paymentTypeName},
			</if>
			<if test="money != null">
				#{money},
			</if>
			<if test="integral != null">
				#{integral},
			</if>
			<if test="paymentIllustrate != null">
				#{paymentIllustrate},
			</if>
			<if test="confirmPersionId != null">
				#{confirmPersionId},
			</if>
			<if test="confirmPersionName != null">
				#{confirmPersionName},
			</if>
			<if test="finishDate != null">
				#{finishDate},
			</if>
			<if test="completionType != null">
				#{completionType},
			</if>
			<if test="completionName != null">
				#{completionName},
			</if>
			<if test="completionIllustrate != null">
				#{completionIllustrate},
			</if>
			<if test="userId != null">
				#{userId},
			</if>
			<if test="userName != null">
				#{userName},
			</if>
			<if test="takeDate != null">
				#{takeDate},
			</if>
			<if test="sendSingleId != null">
				#{sendSingleId},
			</if>
			<if test="sendSingleName != null">
				#{sendSingleName},
			</if>
			<if test="distributeDate != null">
				#{distributeDate},
			</if>
			<if test="distributeIllustrate != null">
				#{distributeIllustrate},
			</if>
			<if test="cancelOrderPersonId != null">
				#{cancelOrderPersonId},
			</if>
			<if test="cancelOrderPersonName != null">
				#{cancelOrderPersonName},
			</if>
			<if test="cancelOrderIllustrate != null">
				#{cancelOrderIllustrate},
			</if>
			<if test="cancelDate != null">
				#{cancelDate},
			</if>
			<if test="cancelTakePersonId != null">
				#{cancelTakePersonId},
			</if>
			<if test="cancelTakePersonName != null">
				#{cancelTakePersonName},
			</if>
			<if test="cancelTakeIllustrate != null">
				#{cancelTakeIllustrate},
			</if>
			<if test="cancelTakeDate != null">
				#{cancelTakeDate},
			</if>
			<if test="cancelSendPersonName != null">
				#{cancelSendPersonName},
			</if>
			<if test="cancelSendPersonId != null">
				#{cancelSendPersonId},
			</if>
			<if test="cancelSendIllustrate != null">
				#{cancelSendIllustrate},
			</if>
			<if test="cancelSendDate != null">
				#{cancelSendDate},
			</if>
			<if test="salesman != null and salesman.id!=null">
				#{salesman.id},
			</if>
			<if test="createDate != null">
				#{createDate},
			</if>
			<if test="enable != null">
				#{enable},
			</if>
			<if test="evaluateId != null">
				#{evaluateId},
			</if>
			<if test="lengthService != null">
				#{lengthService},
			</if>
			<if test="failureTypeId != null">
				#{failureTypeId},
			</if>
			<if test="failureTypeName != null">
				#{failureTypeName},
			</if>
			<if test="appUserId != null">
				#{appUserId},
			</if>
		</trim>
	</insert>
	
	<insert id="insertSelectiveImg" parameterType="com.sdcloud.api.lar.entity.RecyclingImg">
		insert into lar_recyclingimg
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="imgUrl != null">
				imgUrl,
			</if>
			<if test="orderManager != null and orderManager.id!=null">
				orderManagerId,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id},
			</if>
			<if test="imgUrl != null">
				#{imgUrl},
			</if>
			<if test="orderManager != null and orderManager.id!=null">
				#{orderManager.id},
			</if>
		</trim>
	</insert>
	
	<insert id="insertSelectiveChild" parameterType="com.sdcloud.api.lar.entity.ChildOrders">
		insert into lar_childorders 
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="recyclingMaterial != null and recyclingMaterial.id!=null">
				recyclingMaterialId,
			</if>
			<if test="number != null">
				number,
			</if>
			<if test="orderManager != null and orderManager.id!=null">
				orderManagerId,
			</if>
			<if test="enable != null">
				enable,
			</if>
			<if test="createDate != null">
				createDate,
			</if>
			<if test="confirmOrder != null">
				confirmOrder,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id},
			</if>
			<if test="recyclingMaterial != null and recyclingMaterial.id!=null">
				#{recyclingMaterial.id},
			</if>
			<if test="number != null">
				#{number},
			</if>
			<if test="orderManager != null and orderManager.id!=null">
				#{orderManager.id},
			</if>
			<if test="enable != null">
				#{enable},
			</if>
			<if test="createDate != null">
				#{createDate},
			</if>
			<if test="confirmOrder != null">
				#{confirmOrder},
			</if>
		</trim>
	</insert>
	<select id="selectByExample" resultMap="listResult" parameterType="com.sdcloud.framework.entity.LarPager">
		select 
		<if test="larPager.distinct==true">
			distinct 
		</if>
		<include refid="Base_Column_List" /> 
		from lar_ordermanager o left outer join lar_areasettings a  on(o.areaSettingId=a.id)
		<where>
			o.enable=0 
			<if test="larPager.params!=null and larPager.params.size>0">
				<!-- index 作为map 的key。item为map的值，这里使用了嵌套循环，嵌套循环使用ent。 -->
				<if test="larPager.params.orderStatusId!=null">
					and orderStatusId=#{larPager.params.orderStatusId}
				</if>
				<if test="larPager.params.mechanismId!=null">
					and a.mechanismId=#{larPager.params.mechanismId} 
				</if>
				<if test="larPager.params.orderStatusIds!=null and larPager.params.orderStatusIds.size>0">
					and orderStatusId in 
					<foreach item="item" index="index" collection="larPager.params.orderStatusIds" open="(" separator="," close=")">
                        #{item}
                	</foreach>
				</if>
				<if test="larPager.params.completionType != null">
					and completionType=#{larPager.params.completionType}
				</if>
				<if test="larPager.params.upOrder !=null and larPager.params.upOrder=='true'">
					<if test="larPager.params.endDate==null">
						<![CDATA[
							and placeOrder> #{larPager.params.firstDate}
						]]>
					</if>
					<if test="larPager.params.firstDate==null">
						<![CDATA[
							and placeOrder < #{larPager.params.endDate}
						]]>
					</if>
					<if test="larPager.params.endDate!=null and larPager.params.firstDate!=null">
						<![CDATA[
							and placeOrder < #{larPager.params.endDate} and placeOrder> #{larPager.params.firstDate}
						]]>
					</if>
				</if>
				<if test="larPager.params.disOrder !=null and larPager.params.disOrder=='true'">
					<if test="larPager.params.endDate==null">
						<![CDATA[
							and takeDate> #{larPager.params.firstDate}
						]]>
					</if>
					<if test="larPager.params.firstDate==null">
						<![CDATA[
							and takeDate < #{larPager.params.endDate}
						]]>
					</if>
					<if test="larPager.params.endDate!=null and larPager.params.firstDate!=null">
						<![CDATA[
							and takeDate < #{larPager.params.endDate} and takeDate> #{larPager.params.firstDate}
						]]>
					</if>
				</if>
				<if test="larPager.params.sendOrder !=null and larPager.params.sendOrder=='true'">
					<if test="larPager.params.endDate==null">
						<![CDATA[
							and distributeDate> #{larPager.params.firstDate}
						]]>
					</if>
					<if test="larPager.params.firstDate==null">
						<![CDATA[
							and distributeDate < #{larPager.params.endDate}
						]]>
					</if>
					<if test="larPager.params.endDate!=null and larPager.params.firstDate!=null">
						<![CDATA[
							and distributeDate < #{larPager.params.endDate} and distributeDate> #{larPager.params.firstDate}
						]]>
					</if>
				</if>
				<if test="larPager.params.evaluateId !=null">
					and evaluateId = #{larPager.params.evaluateId}
				</if>
				<if test="larPager.params.orderId !=null">
					and orderId = #{larPager.params.orderId}
				</if>
				<if test="larPager.params.paymentTypeId !=null">
					and paymentTypeId = #{larPager.params.paymentTypeId}
				</if>
				<if test="larPager.params.salesman !=null">
					and salesmanId = #{larPager.params.salesman}
				</if>
				<if test="larPager.params.areaSetting !=null">
					and areaSettingId = #{larPager.params.areaSetting}
				</if>
				<if test="larPager.params.failureType !=null">
					and failureTypeId = #{larPager.params.failureType}
				</if>
				<if test="larPager.params.childOrders !=null and larPager.params.childOrders.id !=null">
					and id=#{larPager.params.childOrders.id}
				</if>
			</if>
		</where>
		<if test="larPager.orderBy != null and larPager.order!=null">
			order by ${larPager.orderSql}
		</if>
		<if test="larPager.first!=null and larPager.pageSize!=null">
			limit #{larPager.first}, #{larPager.pageSize}
		</if>
	</select>
	<resultMap type="com.sdcloud.api.lar.entity.OrderManager" id="listResult">
		<id property="id" column="o_id"/>
		<association property="larClientUserAddress" column="larClientUserAddressId" javaType="com.sdcloud.api.lar.entity.LarClientUserAddress" select="com.sdcloud.biz.lar.dao.LarClientUserAddressDao.selectById"></association>
		<association property="salesman" column="salesmanId" javaType="com.sdcloud.api.lar.entity.Salesman" select="selectSalesman"></association>
		<collection property="recyclingImg" ofType="com.sdcloud.api.lar.entity.RecyclingImg" javaType="java.util.List" column="o_id" select="selectRecyclingImg"></collection>
	</resultMap>
	<select id="selectRecyclingImg" resultType="com.sdcloud.api.lar.entity.RecyclingImg">
		select `id`,`imgUrl`,`orderManagerId` from lar_recyclingimg where orderManagerId=#{id}
	</select>
	<select id="selectSalesman" resultType="com.sdcloud.api.lar.entity.Salesman">
		select `id`,`areaSettingId` as "areaSetting.id",`manId`,`manName`,`deviceId`,`ownedSupplierId`,`manDescribe`,
		`personnelId` as "personnel.id",`createDate`,`enable` from lar_salesman where id=#{salesmanId}
	</select>
	
	<select id="selectCildByExample" resultType="com.sdcloud.api.lar.entity.ChildOrders" parameterType="com.sdcloud.framework.entity.LarPager">
		select 
		<if test="larPager.distinct==true">
			distinct 
		</if>
		<include refid="Child_Column_List" /> 
		FROM `lar_childorders` c LEFT OUTER JOIN `lar_recyclingmaterial` r ON(c.recyclingMaterialId=r.id) 
		LEFT OUTER JOIN `lar_recyclingtype` t ON(r.recyclingTypeId=t.id) 
		<where>
			c.enable=0
			<if test="larPager.params!=null and larPager.params.size>0">
				<!-- index 作为map 的key。item为map的值，这里使用了嵌套循环，嵌套循环使用ent。 -->
				<if test="larPager.params.orderId!=null">
					and orderManagerId=#{larPager.params.orderId}
				</if>
				<if test="larPager.params.confirmOrder!=null">
					and confirmOrder=#{larPager.params.confirmOrder}
				</if>
			</if>
		</where>
		<if test="larPager.orderBy != null and larPager.order!=null">
			order by ${larPager.orderSql}
		</if>
	</select>

	<update id="updateByExampleSelective" parameterType="map">
		update lar_ordermanager
		<set>
			<if test="params.orderManager.businessTypeId != null">
				businessTypeId = #{params.orderManager.businessTypeId},
			</if>
			<if test="params.orderManager.businessTypeName != null">
				businessTypeName = #{params.orderManager.businessTypeName},
			</if>
			<if test="params.orderManager.areaSetting != null and params.orderManager.areaSetting.id != null">
				areaSettingId = #{params.orderManager.areaSetting.id},
			</if>
			<if test="params.orderManager.placeOrder != null">
				placeOrder = #{params.orderManager.placeOrder},
			</if>
			<if test="params.orderManager.orderStatusId != null">
				orderStatusId = #{params.orderManager.orderStatusId},
			</if>
			<if test="params.orderManager.orderStatusName != null">
				orderStatusName = #{params.orderManager.orderStatusName},
			</if>
			<if test="params.orderManager.larClientUserAddress != null and params.orderManager.larClientUserAddress.id != null">
				larClientUserAddressId = #{params.orderManager.larClientUserAddress.id},
			</if>
			<if test="params.orderManager.maaDate != null">
				maaDate = #{params.orderManager.maaDate},
			</if>
			<if test="params.orderManager.orderStatusId != null">
				orderStatusId = #{params.orderManager.orderStatusId},
			</if>
			<if test="params.orderManager.orderStatusName != null">
				orderStatusName = #{params.orderManager.orderStatusName},
			</if>
			<if test="params.orderManager.illustrate != null">
				illustrate = #{params.orderManager.illustrate},
			</if>
			<if test="params.orderManager.paymentTypeId != null">
				paymentTypeId = #{params.orderManager.paymentTypeId},
			</if>
			<if test="params.orderManager.paymentTypeName != null">
				paymentTypeName = #{params.orderManager.paymentTypeName},
			</if>
			<if test="params.orderManager.money != null">
				money = #{params.orderManager.money},
			</if>
			<if test="params.orderManager.integral != null">
				integral = #{params.orderManager.integral},
			</if>
			<if test="params.orderManager.paymentIllustrate!= null">
				paymentIllustrate = #{params.orderManager.paymentIllustrate},
			</if>
			<if test="params.orderManager.confirmPersionId!= null">
				confirmPersionId = #{params.orderManager.confirmPersionId},
			</if>
			<if test="params.orderManager.confirmPersionName!= null">
				confirmPersionName = #{params.orderManager.confirmPersionName},
			</if>
			<if test="params.orderManager.finishDate != null">
				finishDate = #{params.orderManager.finishDate},
			</if>
			<if test="params.orderManager.completionType != null">
				completionType = #{params.orderManager.completionType},
			</if>
			<if test="params.orderManager.completionName != null">
				completionName = #{params.orderManager.completionName},
			</if>
			<if test="params.orderManager.completionIllustrate != null">
				completionIllustrate = #{params.orderManager.completionIllustrate},
			</if>
			<if test="params.orderManager.userId != null">
				userId = #{params.orderManager.userId},
			</if>
			<if test="params.orderManager.userName != null">
				userName = #{params.orderManager.userName},
			</if>
			<if test="params.orderManager.takeDate != null">
				takeDate = #{params.orderManager.takeDate},
			</if>
			<if test="params.orderManager.sendSingleId != null">
				sendSingleId = #{params.orderManager.sendSingleId},
			</if>
			<if test="params.orderManager.sendSingleName != null">
				sendSingleName = #{params.orderManager.sendSingleName},
			</if>
			<if test="params.orderManager.distributeDate != null">
				distributeDate = #{params.orderManager.distributeDate},
			</if>
			<if test="params.orderManager.distributeIllustrate != null">
				distributeIllustrate = #{params.orderManager.distributeIllustrate},
			</if>
			<if test="params.orderManager.cancelOrderPersonId != null">
				cancelOrderPersonId = #{params.orderManager.cancelOrderPersonId},
			</if>
			<if test="params.orderManager.cancelOrderPersonName != null">
				cancelOrderPersonName = #{params.orderManager.cancelOrderPersonName},
			</if>
			<if test="params.orderManager.cancelOrderIllustrate != null">
				cancelOrderIllustrate = #{params.orderManager.cancelOrderIllustrate},
			</if>
			<if test="params.orderManager.cancelDate != null">
				cancelDate = #{params.orderManager.cancelDate},
			</if>
			<if test="params.orderManager.cancelTakePersonId != null">
				cancelTakePersonId = #{params.orderManager.cancelTakePersonId},
			</if>
			<if test="params.orderManager.cancelTakePersonName != null">
				cancelTakePersonName = #{params.orderManager.cancelTakePersonName},
			</if>
			<if test="params.orderManager.cancelTakeIllustrate != null">
				cancelTakeIllustrate = #{params.orderManager.cancelTakeIllustrate},
			</if>
			<if test="params.orderManager.cancelTakeDate != null">
				cancelTakeDate = #{params.orderManager.cancelTakeDate},
			</if>
			<if test="params.orderManager.cancelSendPersonName != null">
				cancelSendPersonName = #{params.orderManager.cancelSendPersonName},
			</if>
			<if test="params.orderManager.cancelSendPersonId != null">
				cancelSendPersonId = #{params.orderManager.cancelSendPersonId},
			</if>
			<if test="params.orderManager.cancelSendIllustrate != null">
				cancelSendIllustrate = #{params.orderManager.cancelSendIllustrate},
			</if>
			<if test="params.orderManager.cancelSendDate != null">
				cancelSendDate = #{params.orderManager.cancelSendDate},
			</if>
			<if test="params.orderManager.salesman != null and params.orderManager.salesman.id != null">
				salesmanId = #{params.orderManager.salesman.id},
			</if>
			<if test="params.orderManager.createDate != null">
				createDate = #{params.orderManager.createDate},
			</if>
			<if test="params.orderManager.enable != null">
				enable = #{params.orderManager.enable},
			</if>
			<if test="params.orderManager.evaluateId != null">
				evaluateId = #{params.orderManager.evaluateId},
			</if>
			<if test="params.orderManager.lengthService != null">
				lengthService = #{params.orderManager.lengthService},
			</if>
			<if test="params.orderManager.failureTypeId != null">
				failureTypeId = #{params.orderManager.failureTypeId},
			</if>
			<if test="params.orderManager.failureTypeName != null">
				failureTypeName = #{params.orderManager.failureTypeName},
			</if>
		</set>
		<where>
			<if test="params.orderManager.id !=null">
				id=#{params.orderManager.id}
			</if>
		</where>
	</update>
	
	<update id="updateByImgSelective" parameterType="map">
		update lar_recyclingimg
		<set>
			<if test="params.recyclingImg.imgUrl != null">
				imgUrl = #{params.recyclingImg.imgUrl},
			</if>
			<if test="params.recyclingImg.imgUrl != null and params.recyclingImg.id != null">
				orderManagerId = #{params.recyclingImg.orderManager.id},
			</if>
		</set>
		<where>
			<if test="params.recyclingImg.id !=null">
				id=#{params.recyclingImg.id}
			</if>
		</where>
	</update>
	
	<update id="updateChildByExampleSelective" parameterType="map">
		update lar_childorders
		<set>
			<if test="params.childOrders.recyclingMaterial != null and params.childOrders.recyclingMaterial.id != null">
				recyclingMaterialId = #{params.childOrders.recyclingMaterial.id},
			</if>
			<if test="params.childOrders.number != null">
				number = #{params.childOrders.number},
			</if>
			<if test="params.childOrders.orderManager != null and params.childOrders.orderManager.id != null">
				orderManagerId = #{params.childOrders.orderManager.id},
			</if>
			<if test="params.childOrders.enable != null">
				enable = #{params.childOrders.enable},
			</if>
		</set>
		<where>
			<if test="params.childOrders.id !=null">
				id=#{params.childOrders.id}
			</if>
		</where>
	</update>
	
	<select id="countByIds" parameterType="map" resultType="long">
		select count(o.id) from lar_ordermanager o left outer join lar_areasettings a on(o.areaSettingId=a.id) 
		<where>
			o.enable = 0 and a.mechanismId=#{params.mechanismId} 
	        <if test="params.orderStatusIds!=null and params.orderStatusIds.size>0">
	        	and orderStatusId in 
				<foreach item="item" index="index" collection="params.orderStatusIds" open="(" separator="," close=")">
		             #{item}
		        </foreach>
	        </if>
			<if test="params.completionType != null">
				and completionType=#{params.completionType}
			</if>
			<if test="params.upOrder !=null and params.upOrder=='true'">
				<if test="params.endDate==null">
					<![CDATA[
						and placeOrder> #{params.firstDate}
					]]>
				</if>
				<if test="params.firstDate==null">
					<![CDATA[
						and placeOrder < #{params.endDate}
					]]>
				</if>
				<if test="params.endDate!=null and params.firstDate!=null">
					<![CDATA[
						and placeOrder < #{params.endDate} and placeOrder> #{params.firstDate}
					]]>
				</if>
			</if>
			<if test="params.disOrder !=null and params.disOrder=='true'">
				<if test="params.endDate==null">
					<![CDATA[
						and takeDate> #{params.firstDate}
					]]>
				</if>
				<if test="params.firstDate==null">
					<![CDATA[
						and takeDate < #{params.endDate}
					]]>
				</if>
				<if test="params.endDate!=null and params.firstDate!=null">
					<![CDATA[
						and takeDate < #{params.endDate} and takeDate> #{params.firstDate}
					]]>
				</if>
			</if>
			<if test="params.sendOrder !=null and params.sendOrder=='true'">
				<if test="params.endDate==null">
					<![CDATA[
						and distributeDate> #{params.firstDate}
					]]>
				</if>
				<if test="params.firstDate==null">
					<![CDATA[
						and distributeDate < #{params.endDate}
					]]>
				</if>
				<if test="params.endDate!=null and params.firstDate!=null">
					<![CDATA[
						and distributeDate < #{params.endDate} and distributeDate> #{params.firstDate}
					]]>
				</if>
			</if>
			<if test="params.evaluateId !=null">
					and evaluateId = #{params.evaluateId}
			</if>
			<if test="params.orderId !=null">
					and orderId = #{params.orderId}
			</if>
			<if test="params.paymentTypeId !=null">
					and paymentTypeId = #{params.paymentTypeId}
			</if>
			<if test="params.salesman !=null">
					and salesmanId = #{params.salesman}
			</if>
			<if test="params.areaSetting !=null">
					and areaSettingId = #{params.areaSetting}
			</if>
			<if test="params.failureType !=null">
					and failureTypeId = #{params.failureType}
			</if>
			<if test="params.childOrders !=null and params.childOrders.id !=null">
				and id=#{params.childOrders.id}
			</if>
		</where>
	</select>
	
	<select id="countByChildId" parameterType="map" resultType="int">
		select count(id) from lar_childorders 
		<where>
			enable = 0 
			<if test="params.orderId!=null">
				and orderManagerId=#{params.orderId}
			</if>
			<if test="params.confirmOrder!=null">
				and confirmOrder=#{params.confirmOrder}
			</if>
		</where>
	</select>
	
	<select id="countTransaction" parameterType="map" resultType="long">
		select count(o.id)  FROM `lar_ordermanager` o LEFT OUTER JOIN `lar_areasettings` s 
		ON(o.`areaSettingId`=s.`id`) LEFT OUTER JOIN `lar_salesman` a ON(o.`salesmanId`=a.id) 
		LEFT OUTER JOIN `lar_ownedsupplier` r ON(a.`ownedSupplierId`=r.`id`) 
		<where>
			o.`enable`=0 and orderStatusId=4 
			<if test="params!=null and params.size>0">
				<if test="params.mechanismId!=null">
					and s.mechanismId=#{params.mechanismId} 
				</if>
				<if test="params.endDate==null and params.firstDate!=null">
					<![CDATA[
						and finishDate> #{params.firstDate}
					]]>
				</if>
				<if test="params.firstDate==null and params.endDate!=null">
					<![CDATA[
						and finishDate < #{params.endDate}
					]]>
				</if>
				<if test="params.endDate!=null and params.firstDate!=null">
					<![CDATA[
						and finishDate < #{params.endDate} and finishDate> #{params.firstDate}
					]]>
				</if>
				<if test="params.areaId!=null">
					and o.areaSettingId=#{params.areaId} 
				</if>
				<if test="params.ownedSupplierId != null">
					and a.ownedSupplierId=#{params.ownedSupplierId}
				</if>
				<if test="params.confirmPersionId !=null">
					and confirmPersionId = #{params.confirmPersionId}
				</if>
				<if test="params.orderId !=null">
					and orderId = #{params.orderId}
				</if>
				<if test="params.salesmanId !=null">
					and a.manId = #{params.salesmanId}
				</if>
			</if>
		</where>
	</select>
	
	<select id="selectTransaction"  resultType="com.sdcloud.api.lar.entity.OrderManager" parameterType="com.sdcloud.framework.entity.LarPager">
		SELECT  
		<if test="larPager.distinct==true">
			distinct 
		</if> 
		o.`id`,a.`manId` as "salesman.manId",a.`manName` as "salesman.manName",s.`mechanismId` as "areaSetting.mechanismId",
		s.`areaName` as "areaSetting.areaName",r.`osName` as "salesman.ownedSupplier.osName",
		paymentTypeId,o.integral,confirmPersionId,confirmPersionName,finishDate,completionIllustrate,
		o.`orderId`,appUserId FROM `lar_ordermanager` o LEFT OUTER JOIN `lar_areasettings` s 
		ON(o.`areaSettingId`=s.`id`) LEFT OUTER JOIN `lar_salesman` a ON(o.`salesmanId`=a.id) 
		LEFT OUTER JOIN `lar_ownedsupplier` r ON(a.`ownedSupplierId`=r.`id`) 
		<where>
			o.`enable`=0 and orderStatusId=4 
			<if test="larPager.params!=null and larPager.params.size>0">
				<if test="larPager.params.mechanismId!=null">
					and s.mechanismId=#{larPager.params.mechanismId} 
				</if>
				<if test="larPager.params.endDate==null and larPager.params.firstDate!=null">
					<![CDATA[
						and finishDate> #{larPager.params.firstDate}
					]]>
				</if>
				<if test="larPager.params.firstDate==null and larPager.params.endDate!=null">
					<![CDATA[
						and finishDate < #{larPager.params.endDate}
					]]>
				</if>
				<if test="larPager.params.endDate!=null and larPager.params.firstDate!=null">
					<![CDATA[
						and finishDate < #{larPager.params.endDate} and finishDate> #{larPager.params.firstDate}
					]]>
				</if>
				<if test="larPager.params.areaId!=null">
					and o.areaSettingId=#{larPager.params.areaId} 
				</if>
				<if test="larPager.params.ownedSupplierId != null">
					and a.ownedSupplierId=#{larPager.params.ownedSupplierId}
				</if>
				<if test="larPager.params.confirmPersionId !=null">
					and confirmPersionId = #{larPager.params.confirmPersionId}
				</if>
				<if test="larPager.params.orderId !=null">
					and orderId = #{larPager.params.orderId}
				</if>
				<if test="larPager.params.salesmanId !=null">
					and a.manId = #{larPager.params.salesmanId}
				</if>
			</if>
		</where>
		<if test="larPager.orderBy != null and larPager.order!=null">
			order by o.${larPager.orderSql}
		</if>
		<if test="larPager.first!=null and larPager.pageSize!=null">
			limit #{larPager.first}, #{larPager.pageSize}
		</if>
	</select>
	<select id="totalCount" resultType="java.lang.Long">
		SELECT count(o.id) FROM `lar_ordermanager` o LEFT OUTER JOIN `lar_address` a ON(o.larClientUserAddressId=a.id) 
		LEFT OUTER JOIN `lar_salesman` s ON(o.`salesmanId`=s.`id`) 
		<where>
			o.enable =0 
			<if test="params.salesman!=null">
				and s.`id`=#{params.salesman}
			</if>
			<if test="params.orderStatusId!=null">
				and orderStatusId=#{params.orderStatusId}
			</if>
			<if test="params.customerId!=null">
				and a.larClientUser=#{params.customerId}
			</if>
			<if test="params.orderId!=null">
				and o.orderId=#{params.orderId}
			</if>
		</where> 
	</select>
	<!-- 等待服务列表的接口，根据业务员，查询服务中订单加子单号的接口,因为后台派单的话是有指派业务员的 -->
	<select id="getOrderByCustomerId" resultMap="queryOrders" parameterType="map">
		SELECT o.id AS o_id,orderId,completionIllustrate,cancelOrderIllustrate,placeOrder,businessTypeId,businessTypeName,
		orderStatusId,orderStatusName,maaDate,sendSingleId,sendSingleName,distributeDate,evaluateId,s.id AS s_id,
		`manId`,`manName`,deviceId,distributeIllustrate,a.id AS a_id,a.userName,contact,address,mechanismId,
		paymentTypeId,paymentTypeName,money,o.integral AS "o_integral",c.id AS c_id,number,confirmOrder,e.id AS e_id,
		e.typeName AS e_typeName,r.id AS r_id,r.goodsId AS r_goodsId,r.goodsName AS r_goodsName,r.imgUrl AS r_imgUrl,
		meteringCompany,o.id AS "orderManager.id",o.orderId AS o_orderId 
		FROM `lar_ordermanager` o LEFT OUTER JOIN `lar_address` a ON(o.larClientUserAddressId=a.id)  
		LEFT OUTER JOIN `lar_salesman` s ON(o.`salesmanId`=s.`id`) 
		LEFT OUTER JOIN `lar_areasettings` t ON(t.id=o.`areaSettingId`) 
		LEFT OUTER JOIN lar_childorders c ON(c.orderManagerId=o.id) 
		LEFT OUTER JOIN `lar_recyclingmaterial` r ON(c.recyclingMaterialId=r.id) 
		LEFT OUTER JOIN `lar_recyclingtype` e ON(r.recyclingTypeId=e.id) 
		<where>
			o.enable =0 
			<if test="params.salesman!=null">
				and s.`id`=#{params.salesman}
			</if>
			<if test="params.orderStatusId!=null">
				and orderStatusId=#{params.orderStatusId}
			</if>
			<if test="params.customerId!=null">
				and a.larClientUser=#{params.customerId}
			</if>
			<if test="params.orderId!=null">
				and o.orderId=#{params.orderId}
			</if>
			<!-- <if test="params.confirmOrder!=null and params.confirmOrder==0">
				and confirmOrder=#{params.confirmOrder} || confirmOrder is null
			</if> -->
			<if test="params.orderStatusIds!=null and params.orderStatusIds.size>0">
				and orderStatusId in 
				<foreach item="item" index="index" collection="params.orderStatusIds" open="(" separator="," close=")">
                	#{item}
               	</foreach>
			</if>
		</where> 
		ORDER BY o.id 
	</select>
	<resultMap type="com.sdcloud.api.lar.entity.OrderManager" id="queryOrders">
		<id property="id" column="o_id"/>
		<result property="orderId" column="orderId" />
		<result property="completionIllustrate" column="completionIllustrate" />
		<result property="cancelOrderIllustrate" column="cancelOrderIllustrate" />
		<result property="placeOrder" column="placeOrder" />
		<result property="businessTypeId" column="businessTypeId" />
		<result property="businessTypeName" column="businessTypeName" />
		<result property="orderStatusId" column="orderStatusId" />
		<result property="orderStatusName" column="orderStatusName" />
		<result property="maaDate" column="maaDate" />
		<result property="sendSingleId" column="sendSingleId" />
		<result property="sendSingleName" column="sendSingleName" />
		<result property="distributeDate" column="distributeDate" />
		<result property="evaluateId" column="evaluateId" />
		<result property="salesman.id" column="s_id" />
		<result property="salesman.manId" column="manId" />
		<result property="salesman.manName" column="manName" />
		<result property="salesman.deviceId" column="deviceId" />
		<result property="distributeIllustrate" column="distributeIllustrate" />
		<result property="larClientUserAddress.id" column="a_id" />
		<result property="larClientUserAddress.userName" column="userName" />
		<result property="larClientUserAddress.contact" column="contact" />
		<result property="larClientUserAddress.address" column="address" />
		<result property="areaSetting.mechanismId" column="mechanismId" />
		<result property="paymentTypeId" column="paymentTypeId" />
		<result property="paymentTypeName" column="paymentTypeName" />
		<result property="money" column="money" />
		<result property="integral" column="o_integral" />
		<collection property="childOrders" javaType="java.util.ArrayList" ofType="com.sdcloud.api.lar.entity.ChildOrders">
			<id column="c_id" property="id" />
			<result column="number" property="number" />
			<result column="confirmOrder" property="confirmOrder" />
			<result column="e_id" property="recyclingMaterial.recyclingTypeId.id" />
			<result column="e_typeName" property="recyclingMaterial.recyclingTypeId.typeName" />
			<result column="r_id" property="recyclingMaterial.id" />
			<result column="r_goodsId" property="recyclingMaterial.goodsId" />
			<result column="r_goodsName" property="recyclingMaterial.goodsName" />
			<result column="r_imgUrl" property="recyclingMaterial.imgUrl" />
			<result column="meteringCompany" property="recyclingMaterial.meteringCompany" />
			<result column="r_imgUrl" property="recyclingMaterial.imgUrl" />
			<result column="o_id" property="orderManager.id" />
			<result column="o_orderId" property="orderManager.orderId" />
		</collection>
		<collection column="o_id" property="recyclingImg" javaType="java.util.ArrayList" ofType="com.sdcloud.api.lar.entity.RecyclingImg" select="getImgById"></collection>
	</resultMap>
	<select id="getImgById" resultType="com.sdcloud.api.lar.entity.RecyclingImg">
		SELECT `imgUrl` FROM `lar_recyclingimg` WHERE `orderManagerId`=#{o_id}
	</select>
	
	<select id="getOrderByUserId" resultMap="getChildOrderByUserId" parameterType="map">
		SELECT o.id as "o_id",finishDate,orderSourceId,integral FROM `lar_ordermanager` o 
		LEFT OUTER JOIN `lar_address` a ON(o.`larClientUserAddressId`=a.id) 
		where o.enable=0 and `orderStatusId`= 4 and a.larClientUser=#{params.userId} order by o.id 
	</select>
	<resultMap id="getChildOrderByUserId" type="com.sdcloud.api.lar.entity.MyPoints">
		<id column="o_id" property="id" />
		<result column="finishDate" property="finishDate" />
		<result column="orderSourceId" property="orderSourceId"/>
		<result column="integral" property="integral"/>
		<collection column="o_id" property="childOrders" javaType="java.util.ArrayList" ofType="com.sdcloud.api.lar.entity.ChildOrders" select="selectChildOrders" ></collection>
	</resultMap>
	<select id="selectChildOrders" resultType="com.sdcloud.api.lar.entity.ChildOrders">
		SELECT c.`id`,`number`,`confirmOrder`, r.`id` AS "recyclingMaterial.id",`goodsName` AS "recyclingMaterial.goodsName",
		`goodsDescribe` AS "recyclingMaterial.goodsDescribe",`meteringCompany` AS "recyclingMaterial.meteringCompany",
		`imgUrl`  AS "recyclingMaterial.imgUrl", t.`id` AS "recyclingMaterial.recyclingTypeId.id",
		`typeName` AS "recyclingMaterial.recyclingTypeId.typeName" FROM `lar_childorders` c 
		LEFT OUTER JOIN `lar_recyclingmaterial` r ON(c.`recyclingMaterialId`=r.id) 
		LEFT OUTER JOIN `lar_recyclingtype` t ON(r.recyclingTypeId=t.id) WHERE c.enable=0 AND confirmOrder=0 and c.`orderManagerId`=#{o_id}
	</select>
	
	<update id="appConfirmOrder" parameterType="map">
		update lar_ordermanager
		<set>
			<if test="params.orderStatusId != null">
				orderStatusId = #{params.orderStatusId},
			</if>
			<if test="params.orderStatusName != null">
				orderStatusName = #{params.orderStatusName},
			</if>
			<if test="params.confirmPersionId !=null">
				confirmPersionId = #{params.confirmPersionId},
			</if>
			<if test="params.confirmPersionName !=null">
				confirmPersionName = #{params.confirmPersionName},
			</if>
			<if test="params.completionType != null">
				completionType = #{params.completionType},
			</if>
			<if test="params.completionName != null">
				completionName = #{params.completionName},
			</if>
			<if test="params.completionIllustrate !=null">
				completionIllustrate = #{params.completionIllustrate},
			</if>
			<if test="params.finishDate != null">
				finishDate = #{params.finishDate},
			</if>
			<if test="params.paymentTypeId != null">
				paymentTypeId = #{params.paymentTypeId},
			</if>
			<if test="params.paymentTypeName != null">
				paymentTypeName = #{params.paymentTypeName},
			</if>
			<if test="params.money != null">
				money = #{params.money},
			</if>
			<if test="params.integral != null">
				integral = #{params.integral},
			</if>
			<if test="params.lengthService != null">
				lengthService = #{params.lengthService},
			</if>
			<if test="params.failureTypeId != null">
				failureTypeId = #{params.failureTypeId},
			</if>
			<if test="params.failureTypeName != null">
				failureTypeName = #{params.failureTypeName},
			</if>
		</set>
		<where>
			<if test="params.orderId">
				orderId=#{params.orderId}
			</if>
		</where>
	</update>
</mapper>